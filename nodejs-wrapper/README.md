# dash-licenses-wrapper

This npm package makes it easier to integrate [dash-licenses](https://github.com/eclipse/dash-licenses) to Eclipse Foundation JavaScript/TypeScript projects, including running license checks during CI on GitHub, e.g. on pull requests. The later is the best way to catch 3PP components that have incompatible or unclear licenses. Optionally, `dash-licenses` can run in `review` mode, to automatically create IP Check tickets, on the Eclipse Foundation Gitlab instance, one for each 3PP component that fails the check, for further scrutiny.

## How to use

This npm package contains a `check_3pp_licenses.js` script that serves as frontend to `dash-licenses`, an example GitHub workflow that uses it and some example configuration files.

To install this package, as a "devDependency" in your project, use one of the following:

```bash
npm install dash-licenses-wrapper --save-dev
yarn add dash-licenses-wrapper --save-dev
```

Once installed, you can run the license check with:

```bash
  npx dash-licenses-wrapper --inputFile=./package-lock.json   # using npm lock file
  npx dash-licenses-wrapper --inputFile=./yarn.lock           # using yarn lock file
```

To get help about using the wrapper, do:

```bash
  npx dash-licenses-wrapper --help
```

It's suggested to add a `scripts` entry in the project's root `package.json`, that calls this wrapper, with the correct parameters. For example:

`npm` project:

```json
"scripts": {
  "license:check": "npm run dash-licenses-wrapper --inputFile=./package-lock.json",
  "license:check:review": "npm run dash-licenses-wrapper --inputFile=./package-lock.json --review",
[...]
```

`yarn` project:

```json
"scripts": {
  "license:check": "yarn run dash-licenses-wrapper --inputFile=./yarn.lock",
  "license:check:review": "yarn run dash-licenses-wrapper --inputFile=./yarn.lock --review",
[...]
```

## Runtime requirements

- relatively recent node.js
- JDK or JRE: to run `dash-licenses`
- An Eclipse Foundation Gitlab token, generated by an Eclipse project committer, is necessary to run the script using the "automatic review mode". See `dash-licenses` [README](https://github.com/eclipse/dash-licenses#readme) for more details.
- To run the bundled GitHub workflow, the Gitlab token needs to be set as a GitHub Secret, named `DASH_TOKEN`.

## configuration file

A configuration file can be used to override defaults.

`dashLicensesConfig.json`:

```json
{
    "project": "ecd.theia",
    "review": true,
    "inputFile": "./package-lock.json",
    "batch": "50",
    "timeout": "240",
    "exclusionsFile": "dashLicensesExclusions.json",
    "summaryFile": "dash-licenses-summary.txt"
}
```

Exclusion file: `<repo_root>/dependency-check-baseline.json`

This file permits to exclude some of the dependencies from consideration. This can be useful for example with dependencies that were approved as "works-with", that `dash-licenses` can't yet handle, or dependencies that are under review but believed to have an acceptable license.

contains one dependency per line, with an optional comment. that can be used to track the justification for excluding the dependency from failing the license check.

For illustration purpose, here's the Eclipse Theia exclusion file, at the time of writing:

```json
{
  "npm/npmjs/-/allure-commandline/2.23.0": "Approved https://gitlab.eclipse.org/eclipsefdn/emo-team/iplab/-/issues/9379",
  "npm/npmjs/-/clone/2.1.2": "Under review, license believed to be MIT: https://gitlab.eclipse.org/eclipsefdn/emo-team/iplab/-/issues/7971",
  "npm/npmjs/-/eslint-plugin-deprecation/1.2.1": "Approved as 'works-with': https://dev.eclipse.org/ipzilla/show_bug.cgi?id=22573",
  "npm/npmjs/-/jschardet/2.3.0": "Approved for Eclipse Theia: https://dev.eclipse.org/ipzilla/show_bug.cgi?id=22481",
  "npm/npmjs/-/jsdom/11.12.0": "Approved as 'works-with': https://dev.eclipse.org/ipzilla/show_bug.cgi?id=23640https://dev.eclipse.org/ipzilla/show_bug.cgi?id=23640",
  "npm/npmjs/-/lzma-native/8.0.6": "Approved as 'works-with': https://gitlab.eclipse.org/eclipsefdn/emo-team/iplab/-/issues/1850",
  "npm/npmjs/-/playwright-core/1.22.2": "Approved as 'works-with': https://gitlab.eclipse.org/eclipsefdn/emo-team/iplab/-/issues/2734",
  "npm/npmjs/@octokit/openapi-types/12.11.0": "Under review: https://gitlab.eclipse.org/eclipsefdn/emo-team/iplab/-/issues/7693",
  "npm/npmjs/@octokit/openapi-types/16.0.0": "Under review: https://gitlab.eclipse.org/eclipsefdn/emo-team/iplab/-/issues/7694"
}

```

## Acknowledgements

This work is based on work contributed to the [Eclipse Theia main git repository](https://github.com/eclipse-theia/theia), by Ericsson and others.
